class BigNumber{constructor(e=0){this.value="number"==typeof e?e:parseFloat(e)||0}add(e){const t=e instanceof BigNumber?e.value:e;return new BigNumber(this.value+t)}subtract(e){const t=e instanceof BigNumber?e.value:e;return new BigNumber(this.value-t)}multiply(e){const t=e instanceof BigNumber?e.value:e;return new BigNumber(this.value*t)}greaterThanOrEqual(e){const t=e instanceof BigNumber?e.value:e;return this.value>=t}lessThan(e){const t=e instanceof BigNumber?e.value:e;return this.value<t}format(){const e=this.value;if(e<1e3)return Math.floor(e).toString();if(e<1e6)return(e/1e3).toFixed(1)+"K";if(e<1e9)return(e/1e6).toFixed(1)+"M";if(e<1e12)return(e/1e9).toFixed(1)+"B";if(e<1e15)return(e/1e12).toFixed(1)+"T";const t=Math.floor(Math.log10(e));return(e/Math.pow(10,t)).toFixed(2)+"e"+t}toNumber(){return this.value}}const RABBIT_DATA={rarities:{common:{name:"Common",multiplier:1,color:"#888888"},rare:{name:"Rare",multiplier:1.1,color:"#3498db"},epic:{name:"Epic",multiplier:1.25,color:"#9b59b6"},legendary:{name:"Legendary",multiplier:1.5,color:"#f39c12"},mythic:{name:"Mythic",multiplier:2,color:"#e74c3c"}},types:[{id:"carrot-muncher",name:"Carrot Muncher"},{id:"dust-sniffer",name:"Dust Sniffer"},{id:"lucky-paws",name:"Lucky Paws"},{id:"speed-hopper",name:"Speed Hopper"},{id:"battle-bunny",name:"Battle Bunny"}]},GameState={magicDust:new BigNumber(0),totalEarned:new BigNumber(0),lifetimeDust:new BigNumber(0),burrowTokens:0,prestigeCount:0,gems:100,noAdsUntil:0,purchaseHistory:[],settings:{sfxVolume:.5,musicVolume:.3,particlesEnabled:!0,soundEnabled:!0},lastSaveTime:Date.now(),lastSpinTime:0,lastFlipTime:0,activeBoosts:[],rabbits:[],assignedRabbits:{},buildings:[{id:"rabbit-farm",name:"Rabbit Farm",level:1,baseCost:50,baseProduction:1,costGrowthFactor:1.07,productionGrowthFactor:1.15,accumulatedDust:0,unlocked:!0,unlockRequirement:null},{id:"weed-patch",name:"Weed Patch",level:0,baseCost:1e3,baseProduction:10,costGrowthFactor:1.08,productionGrowthFactor:1.15,accumulatedDust:0,unlocked:!1,unlockRequirement:{buildingId:"rabbit-farm",level:15}},{id:"bake-shop",name:"Bake Shop",level:0,baseCost:15e3,baseProduction:80,costGrowthFactor:1.09,productionGrowthFactor:1.15,accumulatedDust:0,unlocked:!1,unlockRequirement:{buildingId:"weed-patch",level:15}},{id:"infused-field",name:"Infused Field",level:0,baseCost:2e5,baseProduction:500,costGrowthFactor:1.1,productionGrowthFactor:1.16,accumulatedDust:0,unlocked:!1,unlockRequirement:{buildingId:"bake-shop",level:15}},{id:"energy-extractor",name:"Energy Extractor",level:0,baseCost:25e5,baseProduction:3e3,costGrowthFactor:1.12,productionGrowthFactor:1.18,accumulatedDust:0,unlocked:!1,unlockRequirement:{buildingId:"infused-field",level:20}}]},AudioContext=window.AudioContext||window.webkitAudioContext;let audioCtx=null;function initAudio(){audioCtx||(audioCtx=new AudioContext)}function playSound(e){if(!GameState.settings.soundEnabled||!audioCtx)return;const t=GameState.settings.sfxVolume;if(0===t)return;const n=audioCtx.currentTime,a=audioCtx.createOscillator(),o=audioCtx.createGain();switch(a.connect(o),o.connect(audioCtx.destination),e){case"collect":a.frequency.setValueAtTime(523.25,n),a.frequency.exponentialRampToValueAtTime(1046.5,n+.1),o.gain.setValueAtTime(.3*t,n),o.gain.exponentialRampToValueAtTime(.01,n+.2),a.start(n),a.stop(n+.2);break;case"upgrade":a.type="square",a.frequency.setValueAtTime(200,n),a.frequency.exponentialRampToValueAtTime(800,n+.15),o.gain.setValueAtTime(.2*t,n),o.gain.exponentialRampToValueAtTime(.01,n+.3),a.start(n),a.stop(n+.3);break;case"purchase":a.frequency.setValueAtTime(800,n),a.frequency.setValueAtTime(600,n+.05),o.gain.setValueAtTime(.25*t,n),o.gain.exponentialRampToValueAtTime(.01,n+.15),a.start(n),a.stop(n+.15);break;case"click":a.frequency.setValueAtTime(1e3,n),o.gain.setValueAtTime(.15*t,n),o.gain.exponentialRampToValueAtTime(.01,n+.05),a.start(n),a.stop(n+.05);break;case"error":a.type="sawtooth",a.frequency.setValueAtTime(150,n),o.gain.setValueAtTime(.2*t,n),o.gain.exponentialRampToValueAtTime(.01,n+.2),a.start(n),a.stop(n+.2)}}function getUpgradeCost(e){return new BigNumber(e.baseCost*Math.pow(e.costGrowthFactor,e.level))}function getGlobalMultiplier(){let e=1;GameState.activeBoosts.forEach(t=>{e*=t.multiplier});const t=1+.1*GameState.burrowTokens;return e*=t,e}const MILESTONES=[10,25,50,100,200,400];function getMilestoneMultiplier(e){let t=1;for(const n of MILESTONES)e>=n&&(t*=2);return t}function getNextMilestone(e){for(const t of MILESTONES)if(e<t)return t;return null}function getProductionRate(e){if(0===e.level)return new BigNumber(0);const t=e.baseProduction*Math.pow(e.productionGrowthFactor,e.level),n=getGlobalMultiplier(),a=getMilestoneMultiplier(e.level);let o=1;const i=GameState.assignedRabbits[e.id];if(i){const e=GameState.rabbits.find(e=>e.id===i);e&&(o=RABBIT_DATA.rarities[e.rarity].multiplier)}return new BigNumber(t*n*a*o)}function canAffordUpgrade(e){return GameState.magicDust.greaterThanOrEqual(getUpgradeCost(e))}function calculatePrestigeReward(){const e=GameState.lifetimeDust.toNumber();return e<1e10?0:Math.floor(Math.log10(e))}function collectDust(e){const t="number"==typeof e?e:0,n=GameState.buildings[t],a=n.accumulatedDust;if(a<=0)return;GameState.magicDust=GameState.magicDust.add(a),GameState.totalEarned=GameState.totalEarned.add(a),GameState.lifetimeDust=GameState.lifetimeDust.add(a),n.accumulatedDust=0,playSound("collect"),showNumberPop(`+${new BigNumber(a).format()} Dust`,"#ffcb05");const o=document.querySelector(`.building-spatial[data-building-index="${t}"]`);if(o){const e=o.getBoundingClientRect(),t=document.getElementById("grassland-scene");if(t){const n=t.getBoundingClientRect();spawnCollectParticles(e.left-n.left+e.width/2+"px",e.top-n.top+e.height/2+"px")}}updateUI(),saveGame()}function upgradeBuilding(e){const t="number"==typeof e?e:0,n=GameState.buildings[t],a=getUpgradeCost(n);if(!GameState.magicDust.greaterThanOrEqual(a))return;GameState.magicDust=GameState.magicDust.subtract(a),n.level++,playSound("upgrade");const o=document.querySelector(`.building-spatial[data-building-index="${t}"]`);o&&spawnUpgradeEffect(o),MILESTONES.includes(n.level)?(showNumberPop(`‚≠ê MILESTONE! ${getMilestoneMultiplier(n.level)}x BONUS! ‚≠ê`),renderBuildings()):showNumberPop("Level Up! üéâ"),updateUI(),checkBuildingUnlocks(),saveGame()}function produceDust(){GameState.buildings.forEach(e=>{if(e.unlocked&&e.level>0){const t=getProductionRate(e).toNumber();e.accumulatedDust+=t}}),updateUI()}const SAVE_KEY="stonedRabbits_saveData";function saveGame(){const e={magicDust:GameState.magicDust.toNumber(),totalEarned:GameState.totalEarned.toNumber(),lifetimeDust:GameState.lifetimeDust.toNumber(),burrowTokens:GameState.burrowTokens,prestigeCount:GameState.prestigeCount,buildings:GameState.buildings,buildings:GameState.buildings,lastSpinTime:GameState.lastSpinTime,lastFlipTime:GameState.lastFlipTime,activeBoosts:GameState.activeBoosts,rabbits:GameState.rabbits,assignedRabbits:GameState.assignedRabbits,lastSaveTime:Date.now()};try{localStorage.setItem(SAVE_KEY,JSON.stringify(e))}catch(e){console.error("Save failed:",e)}}function loadGame(){try{const e=localStorage.getItem(SAVE_KEY);if(!e)return!1;const t=JSON.parse(e);GameState.magicDust=new BigNumber(t.magicDust||0),GameState.totalEarned=new BigNumber(t.totalEarned||0);const n=t.lifetimeDust||0,a=t.totalEarned||0;return GameState.lifetimeDust=new BigNumber(n>0?n:a),GameState.burrowTokens=t.burrowTokens||0,GameState.prestigeCount=t.prestigeCount||0,GameState.prestigeCount=t.prestigeCount||0,GameState.lastSpinTime=t.lastSpinTime||0,GameState.lastFlipTime=t.lastFlipTime||0,GameState.activeBoosts=t.activeBoosts||[],GameState.rabbits=t.rabbits||[],GameState.assignedRabbits=t.assignedRabbits||{},t.buildings?GameState.buildings=GameState.buildings.map(e=>{const n=t.buildings.find(t=>t.id===e.id);return n?{...e,level:n.level,accumulatedDust:n.accumulatedDust||0,unlocked:n.unlocked}:e}):t.buildingLevel&&(GameState.buildings[0].level=t.buildingLevel||1,GameState.buildings[0].accumulatedDust=t.accumulatedDust||0,console.log("üê∞ Migrated legacy save data")),GameState.lastSaveTime=t.lastSaveTime||Date.now(),GameState.buildings.forEach(e=>{0===e.level&&(e.accumulatedDust=0)}),!0}catch(e){return console.error("Load failed:",e),!1}}function calculateOfflineProgress(){const e=Date.now(),t=GameState.lastSaveTime,n=Math.floor((e-t)/1e3),a=Math.min(n,86400);if(a>10){let e=0;return GameState.buildings.forEach(t=>{t.unlocked&&(e+=getProductionRate(t).toNumber())}),{seconds:a,earnings:e*a}}return null}function claimOfflineEarnings(e){GameState.magicDust=GameState.magicDust.add(e),GameState.totalEarned=GameState.totalEarned.add(e),GameState.lifetimeDust=GameState.lifetimeDust.add(e),hideOfflineModal(),updateUI(),saveGame()}function resetGame(){confirm("Are you sure you want to reset ALL progress? This cannot be undone!")&&(GameState.magicDust=new BigNumber(0),GameState.totalEarned=new BigNumber(0),GameState.prestigeCount=0,GameState.lastSpinTime=0,GameState.lastFlipTime=0,GameState.activeBoosts=[],GameState.rabbits=[],GameState.assignedRabbits={},GameState.buildings.forEach(e=>{"rabbit-farm"===e.id?(e.level=1,e.unlocked=!0):(e.level=0,e.unlocked=!1),e.accumulatedDust=0}),localStorage.removeItem(SAVE_KEY),location.reload())}function resetAscendProgress(){confirm("Reset all Ascend progress?\n\nThis will reset:\n- Burrow Tokens\n- Lifetime Dust\n- Prestige Count\n\nYour buildings, rabbits, and current dust will be kept.")&&(GameState.burrowTokens=0,GameState.lifetimeDust=new BigNumber(0),GameState.prestigeCount=0,saveGame(),updatePrestigeModal(),updateUI(),showNumberPop("Ascend Reset!"))}function checkUnlocks(){GameState.buildings.forEach((e,t)=>{if(!e.unlocked&&e.unlockRequirement){const t=e.unlockRequirement,n=GameState.buildings.find(e=>e.id===t.buildingId);n&&n.level>=t.level&&(e.unlocked=!0,showNumberPop(`Unlocked ${e.name}! üîì`),renderBuildings())}})}function renderBuildings(){const e=document.getElementById("building-area");e?(e.innerHTML="",GameState.buildings.forEach((t,n)=>{const a=document.createElement("div");a.className="building "+(t.unlocked?"":"locked"),a.id=`building-${n}`;let o="rabbit-captain.jpg";"rabbit-farm"===t.id&&(o="rabbit-farm-icon.png"),"weed-patch"===t.id&&(o="weed-patch-icon.png"),"bake-shop"===t.id&&(o="bake-shop-icon.png"),"infused-field"===t.id&&(o="infused-field-icon.png"),"energy-extractor"===t.id&&(o="energy-extractor-icon.png");let i="";if(t.unlocked){const e=GameState.assignedRabbits[t.id],n=e?GameState.rabbits.find(t=>t.id===e):null,a=n?RABBIT_DATA.rarities[n.rarity].color:"rgba(255,255,255,0.3)",o=n?"üê∞":"+";i=`\n            <div class="rabbit-slot" onclick="openRabbitSelector('${t.id}')" title="${n?"Change Rabbit":"Assign Rabbit"}"\n                 style="position: absolute; top: 10px; right: 10px; width: 65px; height: 65px; \n                        border: 3px solid ${a}; border-radius: 12px; transform: rotate(5deg);\n                        display: flex; align-items: center; justify-content: center; \n                        background: ${n?"rgba(0,0,0,0.8)":"rgba(0,0,0,0.4)"}; \n                        box-shadow: 0 4px 10px rgba(0,0,0,0.5);\n                        cursor: pointer; z-index: 10; font-size: 1.5rem; color: #fff; transition: transform 0.2s;">\n                ${o}\n                ${n?`<div style="position:absolute; top:-8px; right:-8px; background:${a}; color:#000; font-weight:bold; font-size:0.7rem; padding:2px 6px; border-radius:10px;">Lvl ${n.level}</div>`:""}\n            </div>`}let s=`\n            ${i}\n            <div class="building-icon">\n                <img src="${o}" alt="${t.name}" class="rabbit-nft">\n            </div>\n            <h2 id="name-${n}">${t.name}</h2>\n        `;if(t.unlocked){const e=GameState.assignedRabbits[t.id];let a="";if(e){const t=GameState.rabbits.find(t=>t.id===e);if(t){const e=RABBIT_DATA.types.find(e=>e.id===t.typeId),n=RABBIT_DATA.rarities[t.rarity];a=`<div style="font-size: 0.8rem; color: ${n.color}; margin-bottom: 5px;">üê∞ ${e.name} (√ó${n.multiplier.toFixed(2)})</div>`}}const o=getMilestoneMultiplier(t.level),i=getNextMilestone(t.level),l=i?`Next: L${i} ‚Üí ${2*o}x`:"MAX!";s+=`\n                <div class="building-stats">\n                    <div>Level: <span id="level-${n}">${t.level}</span></div>\n                    <div>Produces: <span id="prod-${n}">${getProductionRate(t).format()}</span>/sec</div>\n                </div>\n                <div class="milestone-info" style="font-size: 0.75rem; color: #f1c40f; margin: 5px 0;">\n                    ‚≠ê ${o}x bonus | <span style="color: #888;">${l}</span>\n                </div>\n                ${a}\n                <div class="accumulated-dust">\n                    Ready to collect: <span id="accum-${n}">${new BigNumber(t.accumulatedDust).format()}</span>\n                </div>\n                <div class="building-buttons">\n                    <button id="btn-collect-${n}" class="game-btn collect-btn">\n                        <span class="btn-icon">‚ú®</span>\n                        <span class="btn-text">Collect</span>\n                    </button>\n                    <button id="btn-upgrade-${n}" class="game-btn upgrade-btn">\n                        <span class="btn-icon">‚¨ÜÔ∏è</span>\n                        <span class="btn-text">Upgrade: <span id="cost-${n}">${getUpgradeCost(t).format()}</span></span>\n                    </button>\n                </div>\n            `}else s+=`\n                <div class="locked-stats">üîí LOCKED</div>\n                <div class="locked-reason">\n                    Requires ${t.unlockRequirement.buildingId.replace("-"," ")} Level ${t.unlockRequirement.level}\n                </div>\n            `;a.innerHTML=s,e.appendChild(a),t.unlocked&&(document.getElementById(`btn-collect-${n}`).onclick=()=>collectDust(n),document.getElementById(`btn-upgrade-${n}`).onclick=()=>upgradeBuilding(n))})):console.log("üì¶ Old building-area not found, skipping legacy render")}function updateUI(){updateInfoBar();const e=document.getElementById("dust-value");e&&(e.textContent=GameState.magicDust.format());let t=new BigNumber(0);GameState.buildings.forEach(e=>{e.unlocked&&(t=t.add(getProductionRate(e)))});const n=document.getElementById("rate-value");n&&(n.textContent=t.format()),renderGrasslandScene(),GameState.buildings.forEach((e,t)=>{if(e.unlocked){const n=document.getElementById(`level-${t}`);if(!n)return;n.textContent=e.level;const a=document.getElementById(`prod-${t}`);a&&(a.textContent=getProductionRate(e).format());const o=document.getElementById(`accum-${t}`);o&&(o.textContent=new BigNumber(e.accumulatedDust).format());const i=getUpgradeCost(e),s=document.getElementById(`cost-${t}`);s&&(s.textContent=i.format());const l=document.getElementById(`btn-upgrade-${t}`);l&&(l.disabled=!canAffordUpgrade(e))}});const a=document.getElementById("total-earned");a&&(a.textContent=GameState.totalEarned.format());const o=document.getElementById("prestige-count");o&&(o.textContent=GameState.prestigeCount);const i=document.getElementById("boost-display");if(i)if(GameState.activeBoosts.length>0){i.classList.remove("hidden");let e=1;GameState.activeBoosts.forEach(t=>e*=t.multiplier);const t=GameState.activeBoosts.reduce((e,t)=>e.endTime>t.endTime?e:t),n=Math.max(0,t.endTime-Date.now()),a=Math.floor(n/36e5%24),o=Math.floor(n/6e4%60),s=Math.floor(n/1e3%60),l=document.getElementById("boost-text");l&&(l.textContent=`${e}x Boost`);const d=document.getElementById("boost-timer");d&&(d.textContent=`${String(a).padStart(2,"0")}:${String(o).padStart(2,"0")}:${String(s).padStart(2,"0")}`)}else i.classList.add("hidden");updateMiniGameTimers();const s=document.getElementById("prestige-modal");s&&!s.classList.contains("hidden")&&updatePrestigeModal(),"ascend"===currentTab&&updatePrestigeTab();const l=document.getElementById("rabbit-count-badge");l&&GameState.rabbits.length>0&&(l.textContent=GameState.rabbits.length,l.classList.remove("hidden"))}function spawnDustParticle(){const e=document.createElement("div");e.className="dust-particle",e.textContent="‚ú®",e.style.left=Math.random()*window.innerWidth+"px",e.style.top=200*Math.random()+200+"px",document.body.appendChild(e),setTimeout(()=>e.remove(),1e3)}function showNumberPop(e){const t=document.createElement("div");t.className="number-pop",t.textContent=e,t.style.left="50%",t.style.top="40%",t.style.transform="translateX(-50%)",document.body.appendChild(t),setTimeout(()=>t.remove(),800)}function showOfflineModal(e){document.getElementById("offline-earnings").textContent=new BigNumber(e).format(),document.getElementById("offline-modal").classList.remove("hidden")}function hideOfflineModal(){document.getElementById("offline-modal").classList.add("hidden")}function showMinigamesModal(){document.getElementById("minigames-modal").classList.remove("hidden")}function hideMinigamesModal(){document.getElementById("minigames-modal").classList.add("hidden")}function activateBoost(e,t,n){const a=Date.now(),o=60*n*1e3,i=GameState.activeBoosts.find(t=>t.id===e);i?(i.endTime<a&&(i.endTime=a),i.endTime+=o):GameState.activeBoosts.push({id:e,multiplier:t,endTime:a+o}),updateUI(),saveGame()}function checkBoosts(){const e=Date.now(),t=GameState.activeBoosts.length;GameState.activeBoosts=GameState.activeBoosts.filter(t=>t.endTime>e),GameState.activeBoosts.length!==t&&(updateUI(),saveGame())}function showPrestigeModal(){updatePrestigeModal(),document.getElementById("prestige-modal").classList.remove("hidden")}function hidePrestigeModal(){document.getElementById("prestige-modal").classList.add("hidden")}function updatePrestigeModal(){const e=GameState.burrowTokens,t=calculatePrestigeReward(),n=GameState.lifetimeDust;document.getElementById("current-tokens").textContent=e,document.getElementById("lifetime-dust").textContent=n.format();const a=document.getElementById("prestige-reward");a.textContent=`+${t} Tokens`;const o=e+t,i=1+.05*o;document.getElementById("new-multiplier").textContent=`${i.toFixed(1)}x`;const s=document.getElementById("new-token-total");s&&(s.textContent=o);const l=document.getElementById("do-prestige-btn");t>=1?(l.disabled=!1,l.style.opacity="1",l.style.cursor="pointer",a.style.color="var(--accent-gold)"):(l.disabled=!0,l.style.opacity="0.5",l.style.cursor="not-allowed",a.style.color="#7f8c8d",a.textContent="+0 Tokens (Need 10B Dust)");let d=new BigNumber(Math.pow(10,10));if(n.toNumber()>10){const e=Math.floor(Math.log10(n.toNumber())),t=Math.max(10,e+1);d=new BigNumber(Math.pow(10,t))}document.getElementById("next-token-goal").textContent=d.format()}function performPrestige(){const e=calculatePrestigeReward();if(!(e<1)&&confirm(`Ascend the Burrow?\n\nYou will earn ${e} Burrow Tokens!\n\nThis resets your buildings and dust.`)){GameState.burrowTokens+=e,GameState.prestigeCount++,GameState.magicDust=new BigNumber(0),GameState.totalEarned=new BigNumber(0),GameState.lastSpinTime=0,GameState.lastFlipTime=0,GameState.buildings.forEach(e=>{"rabbit-farm"===e.id?(e.level=1,e.unlocked=!0):(e.level=0,e.unlocked=!1),e.accumulatedDust=0}),GameState.activeBoosts=[],GameState.assignedRabbits={},saveGame(),showNumberPop("ASCENDED! üåå");for(let e=0;e<30;e++)setTimeout(spawnDustParticle,50*e);setTimeout(()=>{location.reload()},2e3)}}const WHEEL_COOLDOWN=144e5,FLIP_COOLDOWN=36e5;function spinWheel(){const e=Date.now();if(e-GameState.lastSpinTime<WHEEL_COOLDOWN)return;const t=100*Math.random();let n="",a=0,o="",i=new BigNumber(0);GameState.buildings.forEach(e=>{e.unlocked&&(i=i.add(getProductionRate(e)))});const s=i.multiply(60);t<40?(n="dust",a=s.multiply(5),o=`+${a.format()} Dust (Small)`):t<70?(n="dust",a=s.multiply(15),o=`+${a.format()} Dust (Medium)`):t<90?(n="boost",activateBoost("wheel_2x",2,10),o="üî• 2x Production Boost (10m)!"):t<99?(n="boost",activateBoost("wheel_5x",5,5),o="üî•üî• 5x Production Boost (5m)!"):(n="dust",a=s.multiply(100),o=`JACKPOT! +${a.format()} Dust`),"dust"!==n&&"boost"!==n||(GameState.magicDust=GameState.magicDust.add(a),GameState.totalEarned=GameState.totalEarned.add(a),GameState.lifetimeDust=GameState.lifetimeDust.add(a)),GameState.lastSpinTime=e,saveGame(),updateUI(),checkSpinCooldown();const l=document.getElementById("wheel-result");l&&(l.textContent=o,l.style.color="#f1c40f",l.classList.remove("hidden"),setTimeout(()=>l.classList.add("hidden"),3e3));const d=document.getElementById("wheel-result-modal");d&&(d.textContent=o,d.style.color="#f1c40f",d.classList.remove("hidden"),setTimeout(()=>d.classList.add("hidden"),3e3))}function checkSpinCooldown(){const e=Date.now()-GameState.lastSpinTime,t=document.getElementById("spin-wheel-btn"),n=document.getElementById("spin-wheel-btn-modal"),a=document.getElementById("wheel-timer-modal"),o=document.getElementById("wheel-card"),i=document.getElementById("wheel-icon-timer"),s=document.getElementById("wheel-ready-dot");if(e<WHEEL_COOLDOWN){t&&(t.disabled=!0),t&&t.classList.add("disabled"),n&&(n.disabled=!0),n&&n.classList.add("disabled"),a&&a.classList.remove("hidden");const l=WHEEL_COOLDOWN-e,d=Math.floor(l/36e5%24),c=Math.floor(l/6e4%60),r=Math.floor(l/1e3%60),m=`${String(d).padStart(2,"0")}:${String(c).padStart(2,"0")}:${String(r).padStart(2,"0")}`;a&&(a.textContent=`Ready in: ${m}`),o&&o.classList.remove("ready"),i&&(i.textContent=m),i&&i.classList.remove("ready-text"),s&&s.classList.add("hidden")}else t&&(t.disabled=!1),t&&t.classList.remove("disabled"),t&&(t.textContent="Spin!"),n&&(n.disabled=!1),n&&n.classList.remove("disabled"),a&&a.classList.add("hidden"),o&&o.classList.add("ready"),i&&(i.textContent="READY!"),i&&i.classList.add("ready-text"),s&&s.classList.remove("hidden")}function flipCoin(){const e=Date.now();if(e-GameState.lastFlipTime<FLIP_COOLDOWN)return;let t="",n="";Math.random()<.5?(t="WIN! üî• 2x Boost (10m)",n="#2ecc71",activateBoost("coin_2x",2,10),showNumberPop("Coin Flip WIN! üéâ")):(t="LOSS! üò¢ Try again in 1h",n="#e74c3c",showNumberPop("Coin Flip LOST üíÄ"));const a=document.getElementById("flip-result");a&&(a.textContent=t,a.style.color=n,a.classList.remove("hidden"),setTimeout(()=>a.classList.add("hidden"),3e3));const o=document.getElementById("flip-result-modal");o&&(o.textContent=t,o.style.color=n,o.classList.remove("hidden"),setTimeout(()=>o.classList.add("hidden"),3e3)),GameState.lastFlipTime=e,saveGame(),checkFlipCooldown()}function checkFlipCooldown(){const e=Date.now()-GameState.lastFlipTime,t=document.getElementById("play-coin-btn"),n=document.getElementById("play-coin-btn-modal"),a=document.getElementById("flip-timer-modal"),o=document.getElementById("flip-card"),i=document.getElementById("flip-icon-timer"),s=document.getElementById("flip-ready-dot");if(e<FLIP_COOLDOWN){t&&(t.disabled=!0),t&&t.classList.add("disabled"),n&&(n.disabled=!0),n&&n.classList.add("disabled"),a&&a.classList.remove("hidden");const l=FLIP_COOLDOWN-e,d=Math.floor(l/6e4),c=Math.floor(l%6e4/1e3),r=`${d}:${String(c).padStart(2,"0")}`;a&&(a.textContent=`Ready in: ${r}`),o&&o.classList.remove("ready"),i&&(i.textContent=r),i&&i.classList.remove("ready-text"),s&&s.classList.add("hidden")}else t&&(t.disabled=!1),t&&t.classList.remove("disabled"),t&&(t.textContent="Flip!"),n&&(n.disabled=!1),n&&n.classList.remove("disabled"),a&&a.classList.add("hidden"),o&&o.classList.add("ready"),i&&(i.textContent="READY!"),i&&i.classList.add("ready-text"),s&&s.classList.remove("hidden")}const CRATE_COST=1e3,CRATE_DROP_RATES={common:60,rare:25,epic:10,legendary:4,mythic:1};function showRabbitsModal(){document.getElementById("rabbits-modal").classList.remove("hidden"),renderRabbitCollection()}function hideRabbitsModal(){document.getElementById("rabbits-modal").classList.add("hidden")}function renderRabbitCollection(){const e=document.getElementById("rabbit-grid"),t=document.getElementById("no-rabbits");e.innerHTML="",GameState.rabbits&&0!==GameState.rabbits.length?(t.classList.add("hidden"),GameState.rabbits.forEach((t,n)=>{const a=RABBIT_DATA.types.find(e=>e.id===t.typeId),o=RABBIT_DATA.rarities[t.rarity],i=!!Object.entries(GameState.assignedRabbits).find(([e,n])=>n===t.id),s=document.createElement("div");s.className="rabbit-card "+(i?"assigned":""),s.style.borderColor=o.color,s.innerHTML=`\n            <div class="rabbit-name">${a?a.name:"Unknown"}</div>\n            <div class="rabbit-rarity" style="color: ${o.color}">${o.name}</div>\n            <div class="rabbit-mult">√ó${o.multiplier.toFixed(2)}</div>\n            <div class="rabbit-status">${i?"Assigned":"Available"}</div>\n            <button class="assign-btn" onclick="openAssignMenu('${t.id}')" style="margin-top: 5px; padding: 5px 10px; font-size: 0.8rem; background: var(--bg-button); color: white; border: none; border-radius: 5px; cursor: pointer;">\n                ${i?"Reassign":"Assign"}\n            </button>\n        `,e.appendChild(s)})):t.classList.remove("hidden")}function openCrate(){if(GameState.magicDust.lessThan(1e3))return void showNumberPop("Not enough Dust!");GameState.magicDust=GameState.magicDust.subtract(1e3);const e=100*Math.random();let t="common",n=0;for(const[a,o]of Object.entries(CRATE_DROP_RATES))if(n+=o,e<n){t=a;break}const a=Math.floor(Math.random()*RABBIT_DATA.types.length),o=RABBIT_DATA.types[a].id,i={id:`rabbit_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,typeId:o,rarity:t,level:1};GameState.rabbits.push(i),saveGame(),updateUI(),showCrateResult(i)}function showCrateResult(e){const t=RABBIT_DATA.types.find(t=>t.id===e.typeId),n=RABBIT_DATA.rarities[e.rarity];document.getElementById("crate-result-name").textContent=t.name,document.getElementById("crate-result-rarity").textContent=n.name,document.getElementById("crate-result-rarity").style.color=n.color,document.getElementById("crate-result-mult").textContent=`√ó${n.multiplier.toFixed(2)}`,document.getElementById("crate-result-modal").classList.remove("hidden")}function hideCrateResult(){document.getElementById("crate-result-modal").classList.add("hidden"),renderRabbitCollection()}let selectedRabbitId=null;function openRabbitSelector(e){const t=document.getElementById("assign-building-list");t.innerHTML="";const n=document.createElement("h3");n.textContent=`Assign to ${GameState.buildings.find(t=>t.id===e).name}`,n.style.color="var(--accent-gold)",t.appendChild(n);const a=[...GameState.rabbits].sort((e,t)=>RABBIT_DATA.rarities[t.rarity].multiplier-RABBIT_DATA.rarities[e.rarity].multiplier);if(a.forEach(n=>{let a=null;for(const[e,t]of Object.entries(GameState.assignedRabbits))t===n.id&&(a=e);const o=document.createElement("button");o.className="game-btn",o.style.cssText="width: 100%; margin: 5px 0; padding: 10px; display: flex; justify-content: space-between;";const i=RABBIT_DATA.rarities[n.rarity],s=i.multiplier,l=a?a===e?"(Current)":`(at ${GameState.buildings.find(e=>e.id===a).name})`:"Available",d=a?"#7f8c8d":i.color;o.innerHTML=`\n            <span>${i.name} Rabbit (${s}x)</span>\n            <span style="font-size:0.8em; color:${a?"#aaa":"#fff"}">${l}</span>\n        `,a===e?(o.onclick=()=>unassignRabbitFromBuilding(e),o.innerHTML="<span>Unassign Rabbit</span>",o.style.background="#c0392b"):a?(o.disabled=!0,o.style.opacity="0.5"):(o.onclick=()=>assignRabbitToBuilding(n.id,e),o.style.borderColor=d),t.appendChild(o)}),0===a.length&&(t.innerHTML+="<p>No rabbits found!</p>"),GameState.assignedRabbits[e]){const n=document.createElement("button");n.className="game-btn",n.textContent="Clear Slot",n.style.background="#7f8c8d",n.onclick=()=>unassignRabbitFromBuilding(e),t.appendChild(n)}document.getElementById("assign-modal").classList.remove("hidden")}function assignRabbitToBuilding(e,t){GameState.assignedRabbits[t]=e,updateUI(),saveGame(),document.getElementById("assign-modal").classList.add("hidden")}function unassignRabbitFromBuilding(e){delete GameState.assignedRabbits[e],updateUI(),saveGame(),document.getElementById("assign-modal").classList.add("hidden")}function openAssignMenu(e){console.log("Legacy assign menu called")}function hideAssignMenu(){document.getElementById("assign-modal").classList.add("hidden"),selectedRabbitId=null}function assignRabbit(e,t){for(const t of Object.keys(GameState.assignedRabbits))GameState.assignedRabbits[t]===e&&delete GameState.assignedRabbits[t];GameState.assignedRabbits[t]=e,saveGame(),updateUI(),renderBuildings(),renderRabbitCollection(),hideAssignMenu(),showNumberPop("Rabbit Assigned! üê∞")}function unassignRabbit(e){for(const t of Object.keys(GameState.assignedRabbits))GameState.assignedRabbits[t]===e&&delete GameState.assignedRabbits[t];saveGame(),updateUI(),renderBuildings(),renderRabbitCollection(),hideAssignMenu()}let lastTick=Date.now();const TICK_RATE=1e3;function gameLoop(){const e=Date.now();e-lastTick>=1e3&&(lastTick=e,checkBoosts(),produceDust(),checkUnlocks(),checkSpinCooldown(),checkFlipCooldown()),requestAnimationFrame(gameLoop)}setInterval(saveGame,3e4);let currentTab="empire";function switchTab(e){document.querySelectorAll(".tab-panel").forEach(e=>{e.classList.remove("active")}),document.querySelectorAll(".nav-tab").forEach(e=>{e.classList.remove("active")});const t=document.getElementById(`tab-${e}`);t&&t.classList.add("active");const n=document.querySelector(`.nav-tab[data-tab="${e}"]`);n&&n.classList.add("active"),currentTab=e,"rabbits"===e?renderRabbitsTab():"ascend"===e?updatePrestigeTab():"games"===e&&updateMiniGamesTab()}function renderGrasslandScene(){const e=document.getElementById("buildings-container");if(!e)return void console.warn("‚ö†Ô∏è buildings-container not found! Scene cannot render");console.log(`üå≥ Rendering grassland scene with ${GameState.buildings.length} buildings...`),e.innerHTML="";const t=[{x:"15%",y:"60%"},{x:"45%",y:"50%"},{x:"75%",y:"60%"},{x:"25%",y:"25%"},{x:"65%",y:"25%"}],n=["rabbit-farm.png","weed-patch.png","bake-shop.png","infused-field.png","energy-extractor.png"];GameState.buildings.forEach((a,o)=>{console.log(`  Building ${o}: ${a.name}, unlocked: ${a.unlocked}, position: ${t[o].x}, ${t[o].y}`);const i=document.createElement("div");i.className=a.unlocked?"building-spatial":"building-spatial locked",i.style.left=t[o].x,i.style.top=t[o].y,i.dataset.buildingIndex=o;const s=document.createElement("div");s.className="building-sprite-container";const l=document.createElement("div");l.className="building-sprite";const d=document.createElement("img");if(d.src=n[o],d.alt=a.name,d.style.width="100%",d.style.height="100%",d.style.objectFit="contain",l.appendChild(d),!a.unlocked){const e=document.createElement("div");e.className="lock-icon",e.textContent="üîí",l.appendChild(e)}const c=new BigNumber(a.accumulatedDust);if(a.unlocked&&c.value>0){const e=document.createElement("div");e.className="collect-bubble",e.textContent=`üí∞ ${c.format()}`,e.onclick=e=>{e.stopPropagation(),collectDust(o)},s.appendChild(e)}const r=document.createElement("div");if(r.className="building-label",a.unlocked)r.textContent=`${a.name} L${a.level}`;else{const e=a.unlockRequirement;if(e&&e.buildingId){const t=GameState.buildings.find(t=>t.id===e.buildingId);r.textContent=`üîí ${t?.name||"Building"} L${e.level}`}else r.textContent=`üîí ${a.name}`}s.appendChild(l),s.appendChild(r),i.appendChild(s),a.unlocked&&(i.onclick=()=>showBuildingPanel(o)),e.appendChild(i)}),console.log(`‚úÖ Rendered ${e.children.length} spatial buildings`)}let currentPanelBuilding=null;function showBuildingPanel(e){console.log("üîç showBuildingPanel called with index:",e);const t=GameState.buildings[e];if(!t||!t.unlocked)return void console.warn("‚ö†Ô∏è Building not found or locked, index:",e);currentPanelBuilding=e;const n=document.getElementById("building-panel"),a=document.getElementById("panel-building-name"),o=document.getElementById("panel-building-stats");if(console.log("üìã Panel element:",n),console.log("üìã Name element:",a),console.log("üìã Stats element:",o),!n)return void console.error("‚ùå building-panel element not found!");a.textContent=`${t.name} (Level ${t.level})`;const i=getProductionRate(t),s=new BigNumber(t.accumulatedDust),l=getUpgradeCost(t),d=canAffordUpgrade(t);o.innerHTML=`\n        <div><span>Production:</span><span class="stat-value accent-green">+${i.format()}/s</span></div>\n        <div><span>Ready to Collect:</span><span class="stat-value">${s.format()}</span></div>\n        <div><span>Upgrade Cost:</span><span class="stat-value">${l.format()}</span></div>\n    `;const c=document.getElementById("panel-collect-btn"),r=document.getElementById("panel-upgrade-btn");console.log("üîò Collect button:",c),console.log("üîò Upgrade button:",r),c&&r?(c.disabled=0===s.value,c.textContent=s.value>0?`Collect ${s.format()}`:"Nothing to Collect",c.onclick=()=>{collectDust(e),setTimeout(()=>showBuildingPanel(e),100)},r.disabled=!d,r.textContent=`Upgrade (${l.format()})`,r.onclick=()=>{upgradeBuilding(e),setTimeout(()=>showBuildingPanel(e),100)},console.log("‚úÖ Panel ready to show, removing hidden class"),n.classList.remove("hidden")):console.error("‚ùå Buttons not found in panel!")}function hideBuildingPanel(){document.getElementById("building-panel").classList.add("hidden"),currentPanelBuilding=null}let walkingRabbits=[];function spawnWalkingRabbit(){const e=document.getElementById("rabbits-container");if(!e)return;const t=[{x:"15%",y:"60%"},{x:"45%",y:"50%"},{x:"75%",y:"60%"},{x:"25%",y:"25%"},{x:"65%",y:"25%"}],n=Math.floor(Math.random()*t.length);let a=Math.floor(Math.random()*t.length);for(;a===n;)a=Math.floor(Math.random()*t.length);const o=t[n],i=t[a],s=document.createElement("div");s.className="rabbit-sprite walking",s.textContent="üê∞",s.style.left=o.x,s.style.top=o.y,s.style.fontSize="24px";const l=parseFloat(o.x);parseFloat(i.x)<l&&s.classList.add("flipped"),e.appendChild(s),setTimeout(()=>{s.style.left=i.x,s.style.top=i.y},100),setTimeout(()=>{e.removeChild(s),setTimeout(spawnWalkingRabbit,2e3*Math.random()+1e3)},3500)}function initWalkingRabbits(){setTimeout(()=>spawnWalkingRabbit(),1e3),setTimeout(()=>spawnWalkingRabbit(),3e3),setTimeout(()=>spawnWalkingRabbit(),5e3)}function spawnCollectParticles(e,t){const n=document.getElementById("grassland-scene");if(!n)return;const a=Math.floor(5*Math.random())+8;for(let o=0;o<a;o++){const a=document.createElement("div");a.className="particle collect-particle",a.textContent="‚ú®";const o=60*(Math.random()-.5),i=40*(Math.random()-.5);a.style.left=`calc(${e} + ${o}px)`,a.style.top=`calc(${t} + ${i}px)`,a.style.animationDelay=.2*Math.random()+"s",n.appendChild(a),setTimeout(()=>{a.parentNode&&n.removeChild(a)},1500)}}function spawnUpgradeEffect(e){if(!e)return;const t=document.getElementById("grassland-scene");if(!t)return;const n=e.getBoundingClientRect(),a=t.getBoundingClientRect(),o=n.left-a.left+n.width/2,i=n.top-a.top+n.height/2;for(let e=0;e<12;e++){const n=document.createElement("div");n.className="particle upgrade-particle",n.textContent="‚≠ê";const a=e/12*Math.PI*2,s=60,l=Math.cos(a)*s,d=Math.sin(a)*s;n.style.left=`${o+l}px`,n.style.top=`${i+d}px`,n.style.animationDelay=.05*e+"s",t.appendChild(n),setTimeout(()=>{n.parentNode&&t.removeChild(n)},1200)}const s=document.createElement("div");s.className="level-up-text",s.textContent="+1 LEVEL",s.style.left=`${o}px`,s.style.top=i-40+"px",t.appendChild(s),setTimeout(()=>{s.parentNode&&t.removeChild(s)},1500)}function renderRabbitsTab(){const e=document.getElementById("rabbit-grid-tab"),t=document.getElementById("no-rabbits-tab"),n=document.getElementById("assignment-list");if(e){if(0===GameState.rabbits.length)return e.innerHTML="",void t.classList.remove("hidden");t.classList.add("hidden"),e.innerHTML="",GameState.rabbits.forEach(t=>{const n=RABBIT_DATA.types.find(e=>e.id===t.typeId),a=RABBIT_DATA.rarities[t.rarity],o=Object.values(GameState.assignedRabbits).includes(t.id),i=document.createElement("div");i.className="rabbit-card "+(o?"assigned":""),i.style.borderColor=a.color,i.innerHTML=`\n            <div class="rabbit-name">${n.name}</div>\n            <div class="rabbit-rarity" style="color: ${a.color}">${a.name}</div>\n            <div class="rabbit-mult">√ó${a.multiplier.toFixed(2)}</div>\n            <div class="rabbit-status">Level ${t.level}</div>\n            ${o?'<div class="assigned-badge">‚úÖ Assigned</div>':""}\n            <button class="game-btn assign-btn" style="margin-top: 8px; padding: 6px 12px; font-size: 0.8rem;" \n                    onclick="openAssignMenu('${t.id}')">\n                ${o?"Reassign":"Assign"}\n            </button>\n        `,e.appendChild(i)}),n&&(n.innerHTML="",GameState.buildings.forEach(e=>{if(!e.unlocked)return;const t=GameState.assignedRabbits[e.id];if(t){const a=GameState.rabbits.find(e=>e.id===t);if(a){const t=RABBIT_DATA.types.find(e=>e.id===a.typeId),o=RABBIT_DATA.rarities[a.rarity],i=document.createElement("div");i.className="assignment-item",i.innerHTML=`\n                        <span>${e.name}:</span>\n                        <span style="color: ${o.color}">üê∞ ${t.name} (√ó${o.multiplier.toFixed(1)})</span>\n                    `,n.appendChild(i)}}}),0===n.children.length&&(n.innerHTML='<div style="color: #888; padding: 10px; text-align: center;">No rabbits assigned yet</div>'))}}function updatePrestigeTab(){const e=GameState.burrowTokens,t=calculatePrestigeReward(),n=GameState.lifetimeDust,a=1+.1*e;document.getElementById("current-tokens-tab").textContent=e,document.getElementById("current-multiplier-tab").textContent=`${a.toFixed(1)}x`,document.getElementById("lifetime-dust-tab").textContent=n.format(),document.getElementById("prestige-reward-tab").textContent=`+${t} Tokens`;let o=new BigNumber(Math.pow(10,10));if(n.toNumber()>10){const e=Math.floor(Math.log10(n.toNumber())),t=Math.max(10,e+1);o=new BigNumber(Math.pow(10,t))}document.getElementById("next-token-goal-tab").textContent=o.format();const i=document.getElementById("do-prestige-btn-tab");t>=1?(i.disabled=!1,i.classList.remove("disabled")):(i.disabled=!0,i.classList.add("disabled"))}function updateMiniGamesTab(){updateMiniGameTimers()}function updateMiniGameTimers(){const e=Date.now(),t=e-GameState.lastSpinTime>=WHEEL_COOLDOWN,n=document.getElementById("wheel-status-tab");if(n)if(t)n.innerHTML='<span class="ready-status">‚úÖ Ready to Spin!</span>';else{const t=WHEEL_COOLDOWN-(e-GameState.lastSpinTime),a=Math.floor(t/36e5%24),o=Math.floor(t/6e4%60),i=Math.floor(t/1e3%60);n.innerHTML=`<span class="cooldown-status">üïê ${String(a).padStart(2,"0")}:${String(o).padStart(2,"0")}:${String(i).padStart(2,"0")}</span>`}const a=e-GameState.lastFlipTime>=FLIP_COOLDOWN,o=document.getElementById("flip-status-tab");if(o)if(a)o.innerHTML='<span class="ready-status">‚úÖ Ready to Flip!</span>';else{const t=FLIP_COOLDOWN-(e-GameState.lastFlipTime),n=Math.floor(t/36e5%24),a=Math.floor(t/6e4%60),i=Math.floor(t/1e3%60);o.innerHTML=`<span class="cooldown-status">üïê ${String(n).padStart(2,"0")}:${String(a).padStart(2,"0")}:${String(i).padStart(2,"0")}</span>`}const i=document.getElementById("wheel-quick-status");i&&(i.textContent=t?"‚úÖ":"");const s=document.getElementById("flip-quick-status");s&&(s.textContent=a?"‚úÖ":"")}function updateInfoBar(){const e=document.getElementById("info-dust"),t=document.getElementById("info-rate"),n=document.getElementById("info-tokens"),a=document.getElementById("info-tokens-item"),o=document.getElementById("info-gems"),i=document.getElementById("info-boost"),s=document.getElementById("info-boost-item");if(e&&(e.textContent=GameState.magicDust.format()),t){let e=new BigNumber(0);GameState.buildings.forEach(t=>{t.unlocked&&(e=e.add(getProductionRate(t)))}),t.textContent=e.format()+"/s"}if(n&&GameState.burrowTokens>0?(n.textContent=GameState.burrowTokens,a&&a.classList.remove("hidden")):a&&a.classList.add("hidden"),o&&(o.textContent=GameState.gems),i&&GameState.activeBoosts.length>0){let e=1;GameState.activeBoosts.forEach(t=>e*=t.multiplier),i.textContent=`üî• ${e}x`,s.classList.remove("hidden")}else s&&s.classList.add("hidden")}function openShop(){const e=document.getElementById("shop-modal");e&&e.classList.remove("hidden")}function closeShop(){const e=document.getElementById("shop-modal");e&&e.classList.add("hidden")}function buyItem(e,t){GameState.gems<t?showNumberPop("‚ùå Not enough gems!","#ff0000"):(GameState.gems-=t,playSound("purchase"),e.startsWith("crate-")?handleCratePurchase(e):"boost-2x"===e?handleBoostPurchase():"skip-time"===e&&handleSkipTime(),updateUI(),saveGame(),showNumberPop(`‚úì Purchased ${e}!`,"#ffcb05"))}function handleCratePurchase(e){let t;if("crate-common"===e){const e=Math.random();t=e<.7?"common":e<.95?"rare":"epic"}else if("crate-rare"===e){const e=Math.random();t=e<.6?"rare":e<.95?"epic":"legendary"}else if("crate-epic"===e){const e=Math.random();t=e<.5?"epic":e<.95?"legendary":"mythic"}addRabbit(t),showNumberPop(`üéÅ Got ${t} rabbit!`,RABBIT_DATA.rarities[t].color)}function handleBoostPurchase(){const e=Date.now()+36e5;GameState.activeBoosts.push({id:"shop-boost",multiplier:2,endTime:e}),showNumberPop("‚ö° 2x Production for 1 hour!","#4CAF50")}function handleSkipTime(){GameState.buildings.forEach(e=>{if(!e.unlocked)return;const t=3600*getProductionRate(e).value;e.accumulatedDust+=t}),showNumberPop("‚è∞ Skipped 1 hour of production!","#2196F3")}function buyPremium(e,t){confirm(`Purchase ${e} for ‚Ç¨${t}?\n\n(In the web version, this is simulated. Real payments would be processed via Stripe/PayPal or app stores.)`)&&("no-ads-day"===e?activateNoAds(24):"no-ads-week"===e&&activateNoAds(168),GameState.purchaseHistory.push({product:e,price:t,timestamp:Date.now()}),saveGame(),showNumberPop("üëë Purchase successful!","#4CAF50"))}function activateNoAds(e){const t=60*e*60*1e3;GameState.noAdsUntil=Date.now()+t,updateUI()}function openSettings(){const e=document.getElementById("settings-modal");if(e){const t=document.getElementById("sfx-volume"),n=document.getElementById("sfx-value"),a=document.getElementById("sound-toggle"),o=document.getElementById("particles-toggle");t&&(t.value=100*GameState.settings.sfxVolume),n&&(n.textContent=Math.round(100*GameState.settings.sfxVolume)+"%"),a&&(a.checked=GameState.settings.soundEnabled),o&&(o.checked=GameState.settings.particlesEnabled),e.classList.remove("hidden")}}function closeSettings(){const e=document.getElementById("settings-modal");e&&e.classList.add("hidden"),saveGame()}function hasNoAds(){return Date.now()<GameState.noAdsUntil}function init(){console.log("üê∞ Stoned Rabbits: Idle Empire - Initializing...");const e=loadGame();if(document.addEventListener("click",()=>initAudio(),{once:!0}),e){const e=calculateOfflineProgress();e&&e.earnings>0&&(showOfflineModal(e.earnings),document.getElementById("claim-offline-btn").onclick=()=>{claimOfflineEarnings(e.earnings)})}document.querySelectorAll(".nav-tab").forEach(e=>{e.addEventListener("click",()=>{const t=e.dataset.tab;t&&switchTab(t)})});const t=document.getElementById("quick-shop-btn");t&&(t.onclick=openShop);const n=document.getElementById("quick-wheel-btn");n&&(n.onclick=spinWheel);const a=document.getElementById("quick-flip-btn");a&&(a.onclick=flipCoin);const o=document.getElementById("close-shop-btn");o&&(o.onclick=closeShop);const i=document.getElementById("settings-btn");i&&(i.onclick=openSettings);const s=document.getElementById("close-settings-btn");s&&(s.onclick=closeSettings);const l=document.getElementById("sfx-volume"),d=document.getElementById("sfx-value");l&&d&&(l.oninput=function(){GameState.settings.sfxVolume=this.value/100,d.textContent=this.value+"%"});const c=document.getElementById("sound-toggle");c&&(c.onchange=function(){GameState.settings.soundEnabled=this.checked});const r=document.getElementById("particles-toggle");r&&(r.onchange=function(){GameState.settings.particlesEnabled=this.checked});const m=document.getElementById("spin-wheel-btn-tab");m&&(m.onclick=spinWheel);const u=document.getElementById("play-coin-btn-tab");u&&(u.onclick=flipCoin);const g=document.getElementById("open-crate-btn-tab");g&&(g.onclick=openCrate);const b=document.getElementById("do-prestige-btn-tab");b&&(b.onclick=performPrestige);const p=document.getElementById("reset-ascend-btn-tab");p&&(p.onclick=resetAscendProgress);const f=document.getElementById("reset-btn");f&&(f.onclick=resetGame);const h=document.getElementById("minigames-btn");h&&(h.onclick=showMinigamesModal);const y=document.getElementById("close-minigames-btn");y&&(y.onclick=hideMinigamesModal);const S=document.getElementById("spin-wheel-btn");S&&(S.onclick=spinWheel);const B=document.getElementById("play-coin-btn");B&&(B.onclick=flipCoin);const v=document.getElementById("spin-wheel-btn-modal");v&&(v.onclick=spinWheel);const E=document.getElementById("play-coin-btn-modal");E&&(E.onclick=flipCoin);const G=document.getElementById("prestige-btn");G&&(G.onclick=showPrestigeModal);const w=document.getElementById("close-prestige-btn");w&&(w.onclick=hidePrestigeModal);const I=document.getElementById("do-prestige-btn");I&&(I.onclick=performPrestige);const T=document.getElementById("reset-ascend-btn");T&&(T.onclick=resetAscendProgress);const x=document.getElementById("wheel-card");x&&(x.onclick=spinWheel);const C=document.getElementById("flip-card");C&&(C.onclick=flipCoin);const k=document.getElementById("rabbits-btn");k&&(k.onclick=showRabbitsModal);const L=document.getElementById("close-rabbits-btn");L&&(L.onclick=hideRabbitsModal);const R=document.getElementById("open-crate-btn");R&&(R.onclick=openCrate);const M=document.getElementById("close-panel-btn");if(M&&(M.onclick=hideBuildingPanel),window.openAssignMenu=openAssignMenu,window.hideAssignMenu=hideAssignMenu,window.hideCrateResult=hideCrateResult,window.openRabbitSelector=openRabbitSelector,window.buyItem=buyItem,window.buyPremium=buyPremium,document.querySelectorAll(".modal").forEach(e=>{e.addEventListener("click",t=>{t.target===e&&e.classList.add("hidden")})}),renderBuildings(),renderGrasslandScene(),0===GameState.rabbits.length){const e={id:"starter_rabbit_"+Date.now(),typeId:"carrot-muncher",rarity:"common",level:1};GameState.rabbits.push(e),saveGame(),console.log("üê∞ Gave starter rabbit!"),setTimeout(()=>{showNumberPop("You found a rabbit! üê∞")},1e3)}renderBuildings(),renderGrasslandScene(),updateUI(),gameLoop(),initWalkingRabbits(),console.log("üê∞ Game initialized!")}"loading"===document.readyState?document.addEventListener("DOMContentLoaded",init):init(),window.addEventListener("beforeunload",saveGame),window.addEventListener("visibilitychange",()=>{document.hidden&&saveGame()}),window.GameState=GameState,window.activateBoost=activateBoost,window.resetGame=resetGame;